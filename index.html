<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>
      body { margin: 0; font-family: Arial, sans-serif; }
      .controls {
        position: fixed;
        top: 10px;
        left: 10px;
        background: rgba(0,0,0,0.9);
        color: white;
        padding: 20px;
        border-radius: 8px;
        z-index: 1000;
        font-size: 13px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        max-height: 80vh;
        overflow-y: auto;
      }
      .control-group {
        margin-bottom: 12px;
      }
      .control-group label {
        display: inline-block;
        width: 90px;
        font-size: 12px;
        font-weight: bold;
      }
      .control-group input[type="number"] {
        width: 70px;
        margin-right: 8px;
        padding: 4px;
        border: 1px solid #555;
        background: #333;
        color: white;
        border-radius: 3px;
      }
      .control-group input[type="range"] {
        width: 120px;
        margin-right: 8px;
      }
      .range-group {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
      }
      .range-group label {
        width: 40px;
        font-size: 11px;
      }
      .range-value {
        width: 50px;
        margin-left: 5px;
        font-size: 11px;
        color: #ccc;
      }
      button {
        background: #0066cc;
        color: white;
        border: none;
        padding: 6px 12px;
        margin: 3px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 11px;
        transition: background 0.2s;
      }
      button:hover { background: #0088ff; }
      button.danger { background: #cc3300; }
      button.danger:hover { background: #ff4400; }
      .section-title {
        color: #00ffaa;
        font-weight: bold;
        margin-top: 15px;
        margin-bottom: 8px;
        border-bottom: 1px solid #333;
        padding-bottom: 3px;
      }
      .instructions {
        font-size: 10px;
        color: #aaa;
        margin-top: 10px;
        line-height: 1.3;
      }
    </style>
  </head>
  <body>
    <!-- Enhanced Control Panel -->
    <div class="controls">
      <div><strong>üèóÔ∏è Mine Model Control Panel</strong></div>
      
      <div class="section-title">Model URL</div>
      <div class="control-group">
        <input type="text" id="modelUrl" placeholder="Enter GLB model URL" style="width: 250px;">
        <button onclick="loadNewModel()">Load Model</button>
      </div>
      
      <div class="section-title">Position (X, Y, Z)</div>
      <div class="range-group">
        <label>X:</label>
        <input type="range" id="posXRange" min="-20" max="20" value="0" step="0.1">
        <input type="number" id="posX" value="0" step="0.1">
      </div>
      <div class="range-group">
        <label>Y:</label>
        <input type="range" id="posYRange" min="-10" max="10" value="-1" step="0.1">
        <input type="number" id="posY" value="-1" step="0.1">
      </div>
      <div class="range-group">
        <label>Z:</label>
        <input type="range" id="posZRange" min="-30" max="5" value="-8" step="0.1">
        <input type="number" id="posZ" value="-8" step="0.1">
      </div>

      <div class="section-title">Rotation (degrees)</div>
      <div class="range-group">
        <label>X:</label>
        <input type="range" id="rotXRange" min="-180" max="180" value="0" step="5">
        <input type="number" id="rotX" value="0" step="5">
      </div>
      <div class="range-group">
        <label>Y:</label>
        <input type="range" id="rotYRange" min="-180" max="180" value="0" step="5">
        <input type="number" id="rotY" value="0" step="5">
      </div>
      <div class="range-group">
        <label>Z:</label>
        <input type="range" id="rotZRange" min="-180" max="180" value="0" step="5">
        <input type="number" id="rotZ" value="0" step="5">
      </div>

      <div class="section-title">Scale & Display</div>
      <div class="range-group">
        <label>Scale:</label>
        <input type="range" id="scaleRange" min="0.1" max="20" value="4" step="0.1">
        <input type="number" id="scale" value="4" step="0.1" min="0.1">
      </div>

      <div class="section-title">Quick Actions</div>
      <div class="control-group">
        <button onclick="resetView()">üîÑ Reset All</button>
        <button onclick="centerModel()">üéØ Auto Center</button>
        <button onclick="toggleGrid()">üìê Toggle Grid</button>
      </div>
      <div class="control-group">
        <button onclick="toggleWireframe()">üî≤ Wireframe</button>
        <button onclick="focusOnModel()">üîç Focus Model</button>
        <button onclick="toggleAxes()">üìè Show Axes</button>
      </div>

      <div class="section-title">Camera Controls</div>
      <div class="control-group">
        <button onclick="setCameraView('front')">Front View</button>
        <button onclick="setCameraView('back')">Back View</button>
      </div>
      <div class="control-group">
        <button onclick="setCameraView('left')">Left View</button>
        <button onclick="setCameraView('right')">Right View</button>
      </div>
      <div class="control-group">
        <button onclick="setCameraView('top')">Top View</button>
        <button onclick="setCameraView('bottom')">Bottom View</button>
      </div>

      <div class="instructions">
        <strong>Controls:</strong><br>
        ‚Ä¢ WASD: Move camera<br>
        ‚Ä¢ Mouse: Look around<br>
        ‚Ä¢ G: Toggle grid | R: Reset<br>
        ‚Ä¢ C: Auto center | W: Wireframe<br>
        ‚Ä¢ F: Focus on model
      </div>
    </div>

    <a-scene background="color: #001122" vr-mode-ui="enabled: false">
      <!-- ENHANCED LIGHTING SYSTEM -->
      <a-entity light="type: directional; intensity: 1.0; castShadow: true; shadowCameraVisible: false" 
                position="5 10 5" 
                shadow="type: pcf; mapSize: 2048 2048"></a-entity>
      <a-entity light="type: directional; intensity: 0.6" position="-5 5 5"></a-entity>
      <a-entity light="type: ambient; intensity: 0.5"></a-entity>
      <a-entity light="type: point; intensity: 0.8; distance: 25" position="0 8 -5"></a-entity>

      <!-- REFERENCE GRID with better visibility -->
      <a-entity id="grid" visible="false">
        <!-- Ground plane with grid -->
        <a-plane position="0 -5 0" rotation="-90 0 0" width="40" height="40" 
                 material="color: #222; wireframe: true; opacity: 0.4"></a-plane>
        <!-- Axis indicators -->
        <a-entity id="axes" visible="false">
          <!-- X-axis (Red) -->
          <a-cylinder position="10 0 0" radius="0.1" height="20" 
                      color="red" opacity="0.8" rotation="0 0 90"></a-cylinder>
          <a-text value="X" position="10 1 0" color="red" align="center"></a-text>
          
          <!-- Y-axis (Green) -->
          <a-cylinder position="0 10 0" radius="0.1" height="20" 
                      color="green" opacity="0.8"></a-cylinder>
          <a-text value="Y" position="1 10 0" color="green" align="center"></a-text>
          
          <!-- Z-axis (Blue) -->
          <a-cylinder position="0 0 10" radius="0.1" height="20" 
                      color="blue" opacity="0.8" rotation="90 0 0"></a-cylinder>
          <a-text value="Z" position="0 1 10" color="blue" align="center"></a-text>
        </a-entity>
      </a-entity>

      <!-- MINE MODEL with enhanced features -->
      <a-entity id="mine"
        gltf-model=""
        position="0 -1 -8"
        scale="4 4 4"
        rotation="0 0 0"
        shadow="cast: true; receive: true"
        animation-mixer="">
        
        <!-- Bounding box helper -->
        <a-box id="boundingBox" 
               position="0 0 0" 
               width="2" height="2" depth="2" 
               material="color: yellow; wireframe: true; opacity: 0.5"
               visible="false">
        </a-box>
        
        <!-- Center point marker -->
        <a-sphere id="centerMarker"
                  radius="0.1"
                  color="white"
                  opacity="0.8"
                  visible="false">
        </a-sphere>
      </a-entity>

      <!-- ENHANCED ZONE MARKERS -->
      <a-sphere id="zone1-marker"
        position="-3 1 -7"
        radius="0.2"
        material="color: orange; emissive: orange; emissiveIntensity: 0.6"
        animation="property: scale; to: 1.3 1.3 1.3; dir: alternate; dur: 1000; loop: true">
        <a-text value="Zone 1\n5% Risk" position="0 0.5 0" color="white" align="center" scale="2 2 2"></a-text>
      </a-sphere>

      <a-sphere id="zone2-marker"
        position="2 2 -6"
        radius="0.2"
        material="color: red; emissive: red; emissiveIntensity: 0.8"
        animation="property: scale; to: 1.4 1.4 1.4; dir: alternate; dur: 800; loop: true">
        <a-text value="Zone 2\n15% Risk" position="0 0.5 0" color="white" align="center" scale="2 2 2"></a-text>
      </a-sphere>

      <a-sphere id="zone3-marker"
        position="0 0.5 -12"
        radius="0.2"
        material="color: lime; emissive: lime; emissiveIntensity: 0.6"
        animation="property: scale; to: 1.2 1.2 1.2; dir: alternate; dur: 1200; loop: true">
        <a-text value="Zone 3\n25% Risk" position="0 0.5 0" color="black" align="center" scale="2 2 2"></a-text>
      </a-sphere>

      <!-- ENHANCED INFO PANEL -->
      <a-entity id="infoPanel" position="4 2 -5" rotation="0 -30 0">
        <a-plane width="4" height="2.5" color="#000" opacity="0.9" 
                 material="shader: flat">
        </a-plane>
        <a-text value="‚ö†Ô∏è MINE SAFETY DASHBOARD ‚ö†Ô∏è\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüü† Zone 1: Low Risk (5%)\nüî¥ Zone 2: Moderate Risk (15%)\nüü¢ Zone 3: High Risk (25%)\n\n‚úÖ Escape Routes: ACTIVE\nüì° Monitoring System: ONLINE\nüîã Emergency Power: 98%"
                color="#00ff00" 
                font="kelsonsans"
                wrap-count="30" 
                align="center" 
                position="0 0 0.01"
                scale="0.8 0.8 0.8">
        </a-text>
      </a-entity>

      <!-- FIRST PERSON CAMERA RIG -->
      <a-entity id="rig" 
                position="0 1.7 0"
                movement-controls="fly: false; constrainToNavMesh: false"
                wasd-controls="acceleration: 25; adAxis: x,z; wsAxis: z,x">
        <a-camera id="camera"
                  look-controls="pointerLockEnabled: true; reverseMouseDrag: false" 
                  wasd-controls-enabled="true"
                  position="0 0 0"
                  fov="75"
                  cursor="rayOrigin: mouse">
          <!-- Enhanced crosshair -->
          <a-ring position="0 0 -1" radius-inner="0.003" radius-outer="0.008" 
                  material="color: #00ff00; opacity: 0.9"></a-ring>
          <a-circle position="0 0 -1" radius="0.001" 
                    material="color: #00ff00; opacity: 1"></a-circle>
        </a-camera>
      </a-entity>

      <!-- ENVIRONMENT -->
      <a-sky color="#001133"></a-sky>
      
      <!-- Enhanced atmospheric particles -->
      <a-entity id="particles" position="0 3 -8">
        <a-sphere radius="0.03" material="color: white; opacity: 0.4" 
                  animation="property: position; to: 0 6 0; dur: 4000; loop: true; dir: alternate"></a-sphere>
        <a-sphere radius="0.02" material="color: #cccccc; opacity: 0.3" position="3 0 2"
                  animation="property: position; to: 3 5 2; dur: 5000; loop: true; dir: alternate"></a-sphere>
        <a-sphere radius="0.025" material="color: white; opacity: 0.5" position="-2 0 -3"
                  animation="property: position; to: -2 4 -3; dur: 3500; loop: true; dir: alternate"></a-sphere>
      </a-entity>
    </a-scene>

    <script>
      // Scene initialization
      document.querySelector('a-scene').addEventListener('loaded', function () {
        console.log('Scene loaded successfully');
        setupRangeInputSync();
        // Set default model if none provided
        if (!document.getElementById('modelUrl').value) {
          document.getElementById('modelUrl').value = "https://raw.githubusercontent.com/YOUR_USERNAME/YOUR_REPOSITORY/main/mine_ar_map.glb";
          loadNewModel();
        }
      });

      // Sync range sliders with number inputs
      function setupRangeInputSync() {
        const params = ['posX', 'posY', 'posZ', 'rotX', 'rotY', 'rotZ', 'scale'];
        
        params.forEach(param => {
          const range = document.getElementById(param + 'Range');
          const number = document.getElementById(param);
          
          if (range && number) {
            // Sync range to number
            range.addEventListener('input', function() {
              number.value = range.value;
              if (param === 'scale') {
                applyScale();
              } else {
                updateModel();
              }
            });
            
            // Sync number to range
            number.addEventListener('input', function() {
              range.value = number.value;
              if (param === 'scale') {
                applyScale();
              } else {
                updateModel();
              }
            });
          }
        });
      }

      // Load new model
      function loadNewModel() {
        const mine = document.querySelector('#mine');
        const url = document.getElementById('modelUrl').value.trim();
        
        if (url) {
          mine.setAttribute('gltf-model', `url(${url})`);
          console.log('Loading model:', url);
        } else {
          console.log('No URL provided');
        }
      }

      // Update model position and rotation
      function updateModel() {
        const mine = document.querySelector('#mine');
        const posX = parseFloat(document.getElementById('posX').value);
        const posY = parseFloat(document.getElementById('posY').value);
        const posZ = parseFloat(document.getElementById('posZ').value);
        const rotX = parseFloat(document.getElementById('rotX').value);
        const rotY = parseFloat(document.getElementById('rotY').value);
        const rotZ = parseFloat(document.getElementById('rotZ').value);
        
        mine.setAttribute('position', `${posX} ${posY} ${posZ}`);
        mine.setAttribute('rotation', `${rotX} ${rotY} ${rotZ}`);
        
        // Update range sliders
        document.getElementById('posXRange').value = posX;
        document.getElementById('posYRange').value = posY;
        document.getElementById('posZRange').value = posZ;
        document.getElementById('rotXRange').value = rotX;
        document.getElementById('rotYRange').value = rotY;
        document.getElementById('rotZRange').value = rotZ;
      }

      function applyScale() {
        const mine = document.querySelector('#mine');
        const scale = parseFloat(document.getElementById('scale').value);
        mine.setAttribute('scale', `${scale} ${scale} ${scale}`);
        document.getElementById('scaleRange').value = scale;
      }

      function resetView() {
        const defaults = {
          posX: 0, posY: -1, posZ: -8,
          rotX: 0, rotY: 0, rotZ: 0,
          scale: 4
        };
        
        Object.keys(defaults).forEach(key => {
          document.getElementById(key).value = defaults[key];
          const range = document.getElementById(key + 'Range');
          if (range) range.value = defaults[key];
        });
        
        updateModel();
        applyScale();
      }

      function toggleGrid() {
        const grid = document.querySelector('#grid');
        const currentVisibility = grid.getAttribute('visible');
        grid.setAttribute('visible', currentVisibility === 'false' ? 'true' : 'false');
      }

      function toggleAxes() {
        const axes = document.querySelector('#axes');
        const currentVisibility = axes.getAttribute('visible');
        axes.setAttribute('visible', currentVisibility === 'false' ? 'true' : 'false');
        
        // Also show grid if showing axes
        if (currentVisibility === 'false') {
          document.querySelector('#grid').setAttribute('visible', 'true');
        }
      }

      function centerModel() {
        document.getElementById('posX').value = 0;
        document.getElementById('posY').value = 0;
        document.getElementById('posZ').value = -5;
        document.getElementById('rotY').value = 0;
        updateModel();
      }

      function focusOnModel() {
        const mine = document.querySelector('#mine');
        const rig = document.querySelector('#rig');
        const modelPos = mine.getAttribute('position');
        
        // Position camera to look at the model
        rig.setAttribute('position', `${modelPos.x} ${modelPos.y + 2} ${modelPos.z + 5}`);
      }

      // Camera view presets
      function setCameraView(view) {
        const rig = document.querySelector('#rig');
        const camera = document.querySelector('#camera');
        const mine = document.querySelector('#mine');
        const modelPos = mine.getAttribute('position');
        
        const distance = 8;
        let newPos, newRot;
        
        switch(view) {
          case 'front':
            newPos = `${modelPos.x} ${modelPos.y + 1} ${modelPos.z + distance}`;
            newRot = '0 0 0';
            break;
          case 'back':
            newPos = `${modelPos.x} ${modelPos.y + 1} ${modelPos.z - distance}`;
            newRot = '0 180 0';
            break;
          case 'left':
            newPos = `${modelPos.x - distance} ${modelPos.y + 1} ${modelPos.z}`;
            newRot = '0 90 0';
            break;
          case 'right':
            newPos = `${modelPos.x + distance} ${modelPos.y + 1} ${modelPos.z}`;
            newRot = '0 -90 0';
            break;
          case 'top':
            newPos = `${modelPos.x} ${modelPos.y + distance} ${modelPos.z}`;
            newRot = '-90 0 0';
            break;
          case 'bottom':
            newPos = `${modelPos.x} ${modelPos.y - distance} ${modelPos.z}`;
            newRot = '90 0 0';
            break;
        }
        
        rig.setAttribute('position', newPos);
        camera.setAttribute('rotation', newRot);
      }

      let wireframeMode = false;
      function toggleWireframe() {
        const mine = document.querySelector('#mine');
        const boundingBox = document.querySelector('#boundingBox');
        const centerMarker = document.querySelector('#centerMarker');
        
        wireframeMode = !wireframeMode;
        
        if (wireframeMode) {
          mine.setAttribute('material', 'wireframe: true; opacity: 0.8');
          boundingBox.setAttribute('visible', true);
          centerMarker.setAttribute('visible', true);
        } else {
          mine.removeAttribute('material');
          boundingBox.setAttribute('visible', false);
          centerMarker.setAttribute('visible', false);
        }
      }

      // Enhanced keyboard shortcuts
      document.addEventListener('keydown', function(event) {
        switch(event.key.toLowerCase()) {
          case 'g':
            toggleGrid();
            break;
          case 'r':
            resetView();
            break;
          case 'c':
            centerModel();
            break;
          case 'w':
            toggleWireframe();
            break;
          case 'f':
            focusOnModel();
            break;
          case 'x':
            toggleAxes();
            break;
          case '1':
            setCameraView('front');
            break;
          case '2':
            setCameraView('back');
            break;
          case '3':
            setCameraView('left');
            break;
          case '4':
            setCameraView('right');
            break;
          case '5':
            setCameraView('top');
            break;
          case '6':
            setCameraView('bottom');
            break;
        }
      });

      // Model event handlers
      document.querySelector('#mine').addEventListener('model-loaded', function() {
        console.log('Mine model loaded successfully');
        // Auto-adjust bounding box to model
        setTimeout(() => {
          const model = document.querySelector('#mine');
          const bbox = new THREE.Box3().setFromObject(model.object3D);
          const size = bbox.getSize(new THREE.Vector3());
          const center = bbox.getCenter(new THREE.Vector3());
          
          const boundingBox = document.querySelector('#boundingBox');
          boundingBox.setAttribute('position', `${center.x} ${center.y} ${center.z}`);
          boundingBox.setAttribute('geometry', `width: ${size.x}; height: ${size.y}; depth: ${size.z}`);
        }, 100);
      });

      document.querySelector('#mine').addEventListener('model-error', function(error) {
        console.log('Error loading mine model:', error);
        // Show fallback geometry
        const mine = document.querySelector('#mine');
        mine.innerHTML = '<a-box color="gray" width="3" height="2" depth="4" material="wireframe: true"></a-box>';
      });
    </script>
  </body>
</html>
